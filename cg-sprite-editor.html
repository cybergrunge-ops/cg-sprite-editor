<style>
div {
  -webkit-user-drag: none;
  -khtml-user-drag: none;
  -moz-user-drag: none;
  -o-user-drag: none;
  user-drag: none; 
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -o-user-select: none;
  user-select: none;
}





button{font-family:mono;border:1px solid black;background:#fff;cursor:pointer;margin:0px;line-height:1;}
button:hover{background:#eee}
select{font-family:mono;border:1px solid black;background:#eee;margin:0px;line-height:1;}
select:hover{background:#fff}

.editpixel{overflow:hidden;}
.editpixel:hover::before{content:"+";}

.palettepixel{overflow:hidden;}
.palettepixel:hover::before{content:"+";}

#debug{position:absolute;left:0px;bottom:0px;background:#fff;border:2px blue solid; color:#700; padding:10px;}
#debug::before{content:'DEBUG: '}
</style>

<body style="background:#ddd;color:#111;font-family:mono;line-height:1" onmousedown="mouseisdown=true;" onmouseup="mouseisdown=false;" id = "test">
<div id="debug"></div>
      <canvas id = "mycanvas"></canvas>
<br>
<select id="pxsize">
	<option value="4">4px</option>
	<option value="2">2px</option>
	<option value="1">1px</option>	
	<option value="8">8px</option>	
</select>
	<select id='demosprite'>
		<option value='pinkbox'>pink box</option>
		<option value='angryduckman'>angry duckman</option>
		<option value='test2'>pink skull</option>
		<option value='test3'>cool shroom</option>
	</select> <button onclick="demosprite()">load</button><br>
<input id='sprite' value=''></input>
<br>
	
	
	<br>
	<br><br>

<button onclick="makeeditor()">edit sprite</button><br>
	<br><br><br><br>
	extras:<br><br>
	<button onclick="update_editor()">force update</button><br><button onclick="darkmode()">dark mode</button>
</div>
<div id="editor" style='border:2px solid black;visibility:hidden;position:absolute;left:600;top:50;height:420px;width:550px;'>
	<div id="preview" style="position:absolute;padding:5px; border: #fa0 solid 2px;width:260px"></div>
	<div style="position:absolute;right:0px;border:5px #00f solid;padding:5px">
	Palette: <span id='currentpalette' style='text-decoration:underline;'></span><br>
	<select id='paletteoption'>
		<option value='0'>pal_rp1</option>
		<option value='1'>grayscale</option>
		<option value='2'>pink & blue</option>
		<option value='3'>test3</option>
	</select> <br>
	color: <div id="colorselect" style="display:inline-block;">
	<br><br>	
	
	</div>
	
	<br><br>
	
	
	</div></div>
</body></html>






<script type = "text/javascript">
currentpalette = document.getElementById('currentpalette'); 

// everyone loves debug messages
var debugmsg = document.getElementById('debug');

// demo objects
pinkbox = '1111111111111111120000000000002110200000000002011002000000002001100020000002000110000200002000011000002002000001100000022000000110000002200000011000002002000001100002000020000110002000000200011002000000002001102000000000020112000000000000211111111111111111,0';
angryduckman = '8811188888811188814181111118141888141777777141888881717777171888888102177120188888170201102071888817777777777188817177444477171810101404404101011444177117714441144401444410444181111111111111188817144444417188888111111111188888144418814441888811111881111188,0';
test2 = '8881111111111888881223333222218881233000000332188132330000332318133222333322232113311123321113211232111331112321123321133112332112303333333303211230003113000321813303111130321881233333333322188813131313131188881212131312118888811212121218888888111111118888,2';
test3 = '88888881111188888888811999391888888119339999918881133999339933181999992999939991193322233299292181222211112221188811114444111888888881443018888888888144031888888878814030187888887871430341788888871030304177878787144304411778777771111117778888877777777788888888888888888888,0';

// default palettes
var pal_rp1 = ["#eee","#111","#f0f","#faf","#fc0","#00f","#08f","#090","#0000","#f00","pal_rp1"];
var grayscale = ["#fff","#ddd","#bbb","#999","#777","#555","#333","#111","#0000","#000","grayscale"];
var pinkblue = ["#f0f","#f0a","#f05","#a05","#505","#50f","#00f","#0ff","#0000","#000","pink&blue"];
var test3 = ["#ff0","#fa0","#a50","#0a0","#00a","#0ff","#555","#111","#0000","#000","test3"];

// initialize stuff
var palettes = [pal_rp1, grayscale, pinkblue, test3]
var loadpalette = '';
var selected_palette = pal_rp1;
var selectedcolor = "#111";
var mouseisdown=false; // its so stupid i have to do this smh...

// luxurious function to update the editpixels
function update_editor(){
pp = document.getElementsByClassName('palettepixel');
var spritearray = document.getElementById('sprite').value.split('');
for(i=0;i<256;i++){	document.getElementsByClassName('editpixel')[i].style.background = selected_palette[spritearray[i]];}
for(i=0;i<pp.length;i++){document.getElementsByClassName('palettepixel')[i].style.background = selected_palette[i];}
	}

// if a new palette is selected, update stuff
document.getElementById('paletteoption').addEventListener('change',function(){
selected_palette = palettes[document.getElementById('paletteoption').value]; update_editor(); selectedcolor=selected_palette[0];
debugmsg.innerHTML = "changed palette to "+selected_palette[10]+"<br>for safety, color is set to <u>"+selected_palette[0]+"</u>, thanks! :)"; 
currentpalette.innerHTML = selected_palette[10];})

// for loading sprites
function demosprite(){
	if(document.getElementById('demosprite').value=='pinkbox'){document.getElementById('sprite').value = pinkbox;}
	else if(document.getElementById('demosprite').value=='angryduckman'){document.getElementById('sprite').value = angryduckman;}
	else if(document.getElementById('demosprite').value=='test2'){document.getElementById('sprite').value = test2;}
	else if(document.getElementById('demosprite').value=='test3'){document.getElementById('sprite').value = test3;}
	}

// isn't this gui incredibly nuanced?
function darkmode(){document.body.style.background = "#444"; document.body.style.color="#bbb";}















// the actual drawing stuff is stupid simple, just a main()-type loop.
setInterval( function drawShape() { 
	const canvas = document.getElementById('mycanvas'); 
	const ctx = canvas.getContext('2d'); 
	if (canvas.getContext) { 
	ctx.clearRect(00, 00, 500, 500); 
	object1 = document.getElementById("sprite").value;
// pixel scale
pxsz = document.getElementById('pxsize').value;

var row=0;
for(i=0;i<256;i++){
	var column = i%16;
	if(column==0){row++}
	ctx.fillStyle = selected_palette[ object1.split('')[i] ];
	ctx.fillRect(column*pxsz,row*pxsz,pxsz,pxsz); 
	}

}else {alert('You need Safari or Firefox 1.5+ to see this demo.');}},50)












function returnfalse(){return false;}

function checkindex(color){ return color == selectedcolor}

function editpixel(){ 
	if(mouseisdown==true){
	this.style.background=selectedcolor; 
	debugmsg.innerHTML = 'you set <u>pixel:' + this.id + "</u> to <u>color:"+selectedcolor+'</u> from <u>palette:'+selected_palette[10]+'</u><br>attempt to insert <u>value:'+selected_palette.findIndex(checkindex,selectedcolor) + "</u> to sprite demo"; 
	spritearr = document.getElementById('sprite').value.split('');
	spritearr[this.id] = selected_palette.findIndex(checkindex,selectedcolor);
	
	newspritearr = spritearr.join('');
	document.getElementById('sprite').value = newspritearr;
}
	}

function selectcolor(){ selectedcolor = selected_palette[this.id]; debugmsg.innerHTML = 'you selected <u>color:' + this.id + "</u> from <u>palette:" + selected_palette[10]+"</u>"; }











function makeeditor(){
	pxsz = 16;
	var row=0;
	var editorx = 0;
	var editory = 0;

// only generate divs if not visible
if(document.getElementById('editor').style.visibility!='visible'){
	document.getElementById('editor').style.visibility= 'visible';
	// make preview out of divs
	for(i=0;i<256;i++){
		column = i%16;
		if(column==0){row++}
		let pixeldiv = document.createElement('div');
		pixeldiv.style.background = pal_rp1[ object1.split('')[i] ];
		pixeldiv.style.display = "inline-block";
		pixeldiv.style.height = pxsz+"px";
		pixeldiv.style.width = pxsz+"px"; 
		pixeldiv.className = "editpixel";
		pixeldiv.id = i;
		pixeldiv.draggable = 'false';
		pixeldiv.onmousedown = returnfalse;
		pixeldiv.onmouseover = editpixel;
		document.getElementById("preview").appendChild(pixeldiv);
		}
	// make palette tool
	for(i=0;i<selected_palette.length-1;i++){
		let palettediv = document.createElement('div');	
		palettediv.style.background = selected_palette[i];
		palettediv.style.display = "inline-block";
		palettediv.style.height = pxsz+"px";
		palettediv.style.width = pxsz+"px"; 
		palettediv.className = "palettepixel"; 
		palettediv.draggable = 'false';
		palettediv.id = i;
		palettediv.onclick = selectcolor;
		document.getElementById('colorselect').appendChild(palettediv);
	}}
else{ //put a function here to update the editor's divs i guess
	}
}











</script>



